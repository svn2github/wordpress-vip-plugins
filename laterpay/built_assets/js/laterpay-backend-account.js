!function(e){e(function(){function i(){var i={apiKeyInput:e(".lp_js_validateApiKey"),merchantIdInput:e(".lp_js_validateMerchantId"),apiCredentialsInputs:e(".lp_js_validateApiKey, .lp_js_validateMerchantId"),testMerchantId:e("#lp_js_sandboxMerchantId"),testApiKey:e("#lp_js_sandboxApiKey"),liveMerchantId:e("#lp_js_liveMerchantId"),liveApiKey:e("#lp_js_liveApiKey"),pluginModeIndicator:e("#lp_js_pluginModeIndicator"),pluginModeToggle:e("#lp_js_togglePluginMode"),pluginVisibilitySetting:e("#lp_js_pluginVisibilitySetting"),pluginVisibilityToggle:e("#lp_js_toggleVisibilityInTestMode"),hasInvalidSandboxCredentials:e("#lp_js_hasInvalidSandboxCredentials"),isLive:"lp_is-live",navigation:e(".lp_navigation"),region:e("#lp_js_apiRegionSection"),regionNoticeBlock:e("#lp_js_regionNotice"),showMerchantContractsButton:e("#lp_js_showMerchantContracts"),apiCredentials:e("#lp_js_apiCredentialsSection"),requestSent:!1},n=i.region.val(),t=function(){i.apiKeyInput.bind("input",function(){var e=this;setTimeout(function(){c(e)},50)}),i.merchantIdInput.bind("input",function(){var e=this;setTimeout(function(){p(e)},50)}),i.region.change(function(){r()}),i.pluginModeToggle.change(function(){s()}),i.pluginVisibilityToggle.change(function(){l()}),i.showMerchantContractsButton.bind("click",function(){return e(this).attr("href",e(this).data("href-"+i.region.val())),!0}),window.onbeforeunload=function(){g()}},a=function(){for(var e=0,n=i.apiCredentialsInputs.length;e<n;e++)if(""===i.apiCredentialsInputs.eq(e).val())return void i.apiCredentialsInputs.eq(e).focus()},l=function(){u()?(i.hasInvalidSandboxCredentials.val(1),i.pluginVisibilityToggle.prop("checked",!1),i.testMerchantId.focus(),i.showMerchantContractsButton.velocity("fadeIn",{duration:250}),i.requestSent=!1):i.hasInvalidSandboxCredentials.val(0),d("laterpay_test_mode")},o=function(n){"live"===n?(e("#lp_js_pluginModeIndicator").velocity("fadeOut",{duration:250}),e("#lp_js_liveCredentials").addClass(i.isLive)):(e("#lp_js_pluginModeIndicator").velocity("fadeIn",{duration:250}),e("#lp_js_liveCredentials").removeClass(i.isLive))},s=function(){var e=i.pluginModeToggle,n=e.prop("checked");u()?(e.prop("checked",!1),i.liveMerchantId.focus(),i.requestSent=!1,i.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"})):n?(i.pluginVisibilitySetting.velocity("fadeOut",{duration:250}),i.showMerchantContractsButton.velocity("fadeOut",{duration:250})):i.pluginVisibilitySetting.velocity("fadeIn",{duration:250,display:"inline-block"}),d("laterpay_plugin_mode")},r=function(){var t="laterpay_region";e.post(ajaxurl,e("#"+t).serializeArray(),function(e){i.navigation.showMessage(e),e.success?(n=i.region.val(),i.testMerchantId.val(e.creds.cp_key),i.testApiKey.val(e.creds.api_key),"us"!==n?i.regionNoticeBlock.removeClass("hidden"):i.regionNoticeBlock.addClass("hidden")):i.region.val(n)},"json")},d=function(n){i.requestSent||(i.requestSent=!0,e.post(ajaxurl,e("#"+n).serializeArray(),function(e){i.navigation.showMessage(e),o(e.mode)},"json").done(function(){i.requestSent=!1}))},c=function(n){var t=e(n),a=t.parents("form"),o=t.val().trim(),r=32;if(o.length!==t.val().length&&t.val(o),0===o.length||o.length===r)d(a.attr("id"));else{i.navigation.showMessage(lpVars.i18nApiKeyInvalid,!1);var c=i.testApiKey.parents("form").attr("id");a.attr("id")===c&&l()}u()&&s()},p=function(n){var t=e(n),a=t.parents("form"),o=t.val().trim(),r=22;if(o.length!==t.val().length&&t.val(o),0===o.length||o.length===r)d(a.attr("id"));else{i.navigation.showMessage(lpVars.i18nMerchantIdInvalid,!1);var c=i.testMerchantId.parents("form").attr("id");a.attr("id")===c&&l()}u()&&s()},u=function(){var e=32!==i.liveApiKey.val().length||22!==i.liveMerchantId.val().length;return i.pluginModeToggle.prop("checked")&&e},g=function(){if(u())return lpVars.i18nPreventUnload},v=function(){t(),a()};v()}i()})}(jQuery);